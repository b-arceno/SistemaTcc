<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Carrinho</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <%- include('../partials/header') %>

  <h1 class="titulo-categoria">Seu Carrinho</h1>

  <% if (!carrinho || carrinho.length === 0) { %>
    <p style="text-align: center;">Seu carrinho est√° vazio.</p>
    <div style="text-align:center; margin-top:20px;">
      <a href="/loja">
        <button>Voltar para a Loja</button>
      </a>
    </div>
  <% } else { %>
    <div class="produtos-container">
      <% let total = 0; %>
      <% carrinho.forEach(p => { %>
        <% let subtotal = p.preco * p.quantidade; %>
        <% total += subtotal; %>
        <div class="produto-card">
          <img src="/imagens/<%= p.imagem %>" alt="<%= p.nome %>" />
          <p><%= p.nome %></p>
          <strong>Subtotal: R$ <%= subtotal.toFixed(2) %></strong>
          <p>Qtd: <%= p.quantidade %></p>

          <!-- Atualizar quantidade -->
          <form action="/loja/carrinho/atualizar" method="POST" style="margin-top:10px;">
            <input type="hidden" name="produtoId" value="<%= p.produtoId %>">
            <input type="number" name="quantidade" value="<%= p.quantidade %>" min="1" style="width:50px;">
            <button type="submit">Atualizar</button>
          </form>

          <!-- Remover produto -->
          <form action="/loja/carrinho/remover" method="POST" style="margin-top:5px;">
            <input type="hidden" name="produtoId" value="<%= p.produtoId %>">
            <button type="submit">Remover</button>
          </form>
        </div>
      <% }) %>
    </div>

    <!-- Total geral -->
    <h3 style="text-align:center; margin-top:20px;">Total: R$ <%= total.toFixed(2) %></h3>

    <!-- Finalizar pedido -->
    <div style="text-align:center; margin-top:20px;">
      <a href="/loja/checkout">
        <button>Finalizar Pedido</button>
      </a>
      <a href="/loja" style="margin-left: 20px;">
        <button>Continuar Comprando</button>
      </a>
    </div>
  <% } %>
    <%- include('../partials/footer') %>

</body>
</html>
