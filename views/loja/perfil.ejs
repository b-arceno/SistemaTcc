<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Meu Perfil</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
  <%- include('../partials/header') %>

  <main>
    <section class="perfil-container">
      <h1>Meu Perfil</h1>

      <% if (mensagem) { %>
        <div class="alert"><%= mensagem %></div>
      <% } %>

      <form id="perfil-form" action="/loja/perfil/editar" method="POST">
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" value="<%= usuario.nome %>" required>

        <label for="email">E-mail:</label>
        <input type="email" id="email" name="email" value="<%= usuario.email %>" required>

        <label for="telefone">Telefone:</label>
        <input type="text" id="telefone" name="telefone" value="<%= usuario.telefone || '' %>">

        <button type="button" class="alterar-senha-btn" onclick="toggleSenha()">Alterar Senha</button>

        <div id="senha-section">
          <div class="senha-info">Preencha apenas se quiser alterar sua senha.</div>

          <div class="input-wrapper">
            <input type="password" id="senha" name="senha" placeholder="Nova senha">
            <span class="toggle-senha" onclick="togglePassword('senha')">Mostrar</span>
          </div>

          <div class="input-wrapper">
            <input type="password" id="senha-confirma" name="senhaConfirma" placeholder="Confirme a nova senha">
            <span class="toggle-senha" onclick="togglePassword('senha-confirma')">Mostrar</span>
          </div>
        </div>

        <button type="submit" class="btn-salvar">Atualizar Perfil</button>
      </form>

      <div class="excluir-container">
        <form action="/loja/perfil/excluir" method="POST" onsubmit="return confirm('Tem certeza que deseja excluir sua conta? Esta ação não pode ser desfeita.')">
          <button type="submit" class="btn-excluir">Excluir Conta</button>
        </form>
        <a href="/loja" class="voltar">Voltar para a loja</a>
      </div>
    </section>
  </main>

  <script>
    function toggleSenha() {
      const section = document.getElementById('senha-section');
      section.style.display = section.style.display === 'flex' ? 'none' : 'flex';
    }

    function togglePassword(id) {
      const input = document.getElementById(id);
      input.type = input.type === 'password' ? 'text' : 'password';
    }

    document.getElementById('perfil-form').addEventListener('submit', function(e) {
      const senha = document.getElementById('senha').value;
      const confirma = document.getElementById('senha-confirma').value;
      if (senha || confirma) {
        if (senha !== confirma) {
          e.preventDefault();
          alert('As senhas não coincidem. Verifique e tente novamente.');
        }
      }
    });
  </script>

  <%- include('../partials/footer') %>
</body>
</html>
