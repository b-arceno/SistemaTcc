<h1>Produtos</h1>

<% if (acao === 'listar') { %>
  <a href="/admin/produtos/novo" class="btn">Novo Produto</a>
  <table>
    <thead>
      <tr>
        <th>ID</th><th>Nome</th><th>Preço</th><th>Categoria</th><th>Imagem</th><th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <% produtos.forEach(p => { %>
        <tr>
          <td><%= p.id %></td>
          <td><%= p.nome %></td>
          <td>R$ <%= p.preco.toFixed(2) %></td>
          <td><%= p.categoria %></td>
          <td><% if(p.imagem) { %><img src="/imagens/<%= p.imagem %>" width="50"><% } else { %>-<% } %></td>
          <td>
            <a href="/admin/produtos/editar/<%= p.id %>">Editar</a> |
            <a href="/admin/produtos/excluir/<%= p.id %>">Excluir</a>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } else { %>
  <!-- Formulário Novo / Editar -->
  <h1><%= acao === 'novo' ? 'Novo Produto' : 'Editar Produto' %></h1>
  <form action="<%= acao === 'editar' ? '/admin/produtos/editar/' + produto.id : '/admin/produtos/novo' %>" method="POST" enctype="multipart/form-data">
    <label>Nome</label>
    <input type="text" name="nome" value="<%= produto?.nome || '' %>" required>

    <label>Descrição</label>
    <textarea name="descricao" required><%= produto?.descricao || '' %></textarea>

    <label>Preço</label>
    <input type="number" step="0.01" name="preco" value="<%= produto?.preco || '' %>" required>

    <label>Categoria</label>
    <select name="categoria_id" required>
      <% categorias.forEach(cat => { %>
        <option value="<%= cat.id %>" <%= produto?.categoria_id === cat.id ? 'selected' : '' %>><%= cat.nome %></option>
      <% }) %>
    </select>

    <label>Imagem</label>
    <input type="file" name="imagem">

    <button type="submit">Salvar</button>
  </form>
<% } %>
